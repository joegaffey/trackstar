const express = require("express");
const app = express();
app.use(express.static("public"));
app.use(express.json())

const trackList = {};

app.get("/", (request, response) => {
  response.sendFile(__dirname + "/views/index.html");
});

app.get("/editor", (request, response) => {
  response.sendFile(__dirname + "/views/editor.html");
});

app.post("/tracks", (request, response) => {
  const track = request.body;
  track.id = Date.now();
  trackList[track.id] = track;
  response.send(track);
});

app.get("/tracks", (request, response) => {
  response.send(Object.values(trackList));
});

app.get("/tracks/:trackId", (request, response) => {
  const trackId = request.params.trackId;
  response.send(trackList[trackId]);
});

const listener = app.listen(process.env.PORT, () => {
  console.log("TrackStar is listening on port " + listener.address().port);
});


// Test track from editor
const track_1 = {
    "isReverse": false,
    "isOpen": false,
    "points": [
        {
            "x": -1159.999982714653,
            "y": -1493.9999167025103
        },
        {
            "x": -1674.999975040555,
            "y": -1113.9999223649515
        },
        {
            "x": -2354.999964907766,
            "y": -168.99993644654842
        },
        {
            "x": -2589.999961405993,
            "y": 891.0000477582212
        },
        {
            "x": -1554.9999768286943,
            "y": 1651.0000364333391
        },
        {
            "x": 1989.9999703466901,
            "y": 2426.000024884939
        },
        {
            "x": 3119.999953508379,
            "y": 2121.0000294297934
        },
        {
            "x": 4379.999934732917,
            "y": 1411.0000400096174
        },
        {
            "x": 4664.999930486086,
            "y": -38.99993838369937
        },
        {
            "x": 4119.999938607218,
            "y": -1383.999918341638
        },
        {
            "x": 3764.99994389713,
            "y": -1713.9999134242548
        },
        {
            "x": 2959.9999558925647,
            "y": -1703.9999135732664
        },
        {
            "x": 2254.9999663978824,
            "y": -1303.999919533731
        },
        {
            "x": 1714.9999744445095,
            "y": -243.99993532896133
        },
        {
            "x": 1194.9999821931133,
            "y": -283.9999347329149
        },
        {
            "x": 579.9999913573274,
            "y": -743.999927878381
        },
        {
            "x": 534.9999920278797,
            "y": -1523.9999162554755
        },
        {
            "x": -184.99999724328472,
            "y": -1688.9999137967839
        },
        {
            "x": -769.9999885261059,
            "y": -1643.999914467336
        },
        {
            "x": -1159.999982714653,
            "y": -1493.9999167025103
        }
    ],
    "width": 200,
    "borderWidth": 20,
    "pitBoxCount": 20,
    "starterGap": 80,
    "bgTexture": "grass",
    "trackTexture": "track",
    "bgSize": [
        9356.5648496031,
        6245.282551881851
    ],
    "bgIsTiled": true,
    "gridPositions": [
        {
            "x": -1002.3406374061323,
            "y": -1620.3178713286384,
            "angle": -111.75600349306956
        },
        {
            "x": -894.572237077503,
            "y": -1555.759657798074,
            "angle": -108.21696769795767
        },
        {
            "x": -845.7678671314532,
            "y": -1676.9071412957558,
            "angle": -103.33322416619785
        },
        {
            "x": -747.3193457203248,
            "y": -1597.5299711469484,
            "angle": -100.55406745061691
        },
        {
            "x": -686.7919400777618,
            "y": -1710.5115279314343,
            "angle": -99.09517105312239
        },
        {
            "x": -594.3365940869347,
            "y": -1624.06473169263,
            "angle": -97.27517223010148
        },
        {
            "x": -526.4443261095894,
            "y": -1733.5087808468384,
            "angle": -95.14467477938729
        },
        {
            "x": -440.42526631759495,
            "y": -1640.8935801625223,
            "angle": -92.72725527960131
        },
        {
            "x": -363.314691401769,
            "y": -1744.6249418546201,
            "angle": -90.03533311674312
        },
        {
            "x": -286.10897876496284,
            "y": -1644.73897157907,
            "angle": -87.08135297596982
        },
        {
            "x": -200.06359188954568,
            "y": -1740.4621389523647,
            "angle": -85.47112080754584
        },
        {
            "x": -130.23440716866187,
            "y": -1634.627194822561,
            "angle": -86.57802652902183
        },
        {
            "x": -46.02175174990941,
            "y": -1729.7702474635128,
            "angle": -86.57372490357784
        },
        {
            "x": 26.269990764282355,
            "y": -1625.2691570829088,
            "angle": -85.67455877559621
        },
        {
            "x": 114.99612289758416,
            "y": -1718.8205958151784,
            "angle": -83.9305271078855
        },
        {
            "x": 182.1674075510178,
            "y": -1611.1729349401514,
            "angle": -81.16877647078604
        },
        {
            "x": 281.367969256714,
            "y": -1696.822187010783,
            "angle": -76.93521845784278
        },
        {
            "x": 333.128560821086,
            "y": -1582.496505076545,
            "angle": -70.30656186761001
        }
    ],
    "shapes": [],
    "scale": 1,
    "margin": 1024
}

trackList[1] = track_1;