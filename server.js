const express = require("express");
const app = express();
app.use(express.static("public"));
app.use(express.json());

const trackList = {};

app.get("/", (request, response) => {
  response.sendFile(__dirname + "/views/index.html");
});

app.get("/editor", (request, response) => {
  response.sendFile(__dirname + "/views/editor.html");
});

app.get("/intro", (request, response) => {
  response.sendFile(__dirname + "/views/intro.html");
});

app.post("/tracks", (request, response) => {
  const track = request.body;
  track.id = Date.now();
  trackList[track.id] = track;
  response.send(track);
});

app.get("/tracks", (request, response) => {
  response.send(Object.values(trackList));
});

app.get("/tracks/:trackId", (request, response) => {
  const trackId = request.params.trackId;
  response.send(trackList[trackId]);
});

const listener = app.listen(process.env.PORT, () => {
  console.log("TrackStar is listening on port " + listener.address().port);
});

// Test track from editor
const track_1 = {
  isReverse: false,
  isOpen: false,
  points: [
    { x: -467.0001151114675, y: -378.99993331730457 },
    { x: -1607.0000981241442, y: -58.99993808567615 },
    { x: -2942.0000782310944, y: 1241.0000425428148 },
    { x: -2262.000088363884, y: 2471.000024214387 },
    { x: 677.9998678267029, y: 2446.000024586916 },
    { x: 3567.999824762349, y: 3186.0000135600567 },
    { x: 5227.999800026421, y: 2476.000024139881 },
    { x: 5172.999800845985, y: 996.0000461935992 },
    { x: 4312.999813660984, y: -408.99993287026973 },
    { x: 2612.999838992957, y: -428.9999325722465 },
    { x: 1177.9998603761223, y: -573.9999304115781 },
    { x: -467.0001151114675, y: -378.99993331730457 }
  ],
  width: 200,
  borderWidth: 20,
  pitBoxCount: 20,
  starterGap: 80,
  bgTexture: "grass",
  trackTexture: "track",
  bgSize: [10387.951244407941, 5808.429367956736],
  bgIsTiled: true,
  gridPositions: [
    { x: -269.6139609902027, y: -457.0767575766751, angle: -98.5351077574228 },
    { x: -179.58006272329183, y: -369.46894174603557, angle: -98.57850524830349 },
    { x: -118.43793873906124, y: -479.82376907835254, angle: -98.55226174404959 },
    { x: -26.969530660320007, y: -392.4547267228087, angle: -98.47538507983097 },
    { x: 35.56444096999678, y: -502.87705189826863, angle: -98.35775091580763 },
    { x: 127.58691815792113, y: -415.3231805596812, angle: -98.20429738061102 },
    { x: 191.51695612462703, y: -525.5742939747483, angle: -98.01694166822222 },
    { x: 283.71259306434433, y: -437.5727653801821, angle: -97.79547819716481 },
    { x: 349.20348307246104, y: -547.4708914393342, angle: -97.53795486633214 },
    { x: 441.281374135078, y: -458.7841974982636, angle: -97.24072940613564 },
    { x: 508.57334519081047, y: -568.136728212248, angle: -96.89827339932936 },
    { x: 600.2255071091704, y: -478.4970739884679, angle: -96.50271085717497 },
    { x: 669.6779504093442, y: -587.0594052239305, angle: -96.04300389051377 },
    { x: 760.5275357352311, y: -496.12046726222763, angle: -95.50359443467175 },
    { x: 832.721965211844, y: -603.5365397266706, angle: -94.8621273570136 },
    { x: 922.2186634689676, y: -510.7929883484573, angle: -94.08551206842219 },
    { x: 998.1270524049829, y: -616.4625648252003, angle: -93.12277591842746 },
    { x: 1085.2031904973142, y: -521.0759408813138, angle: -91.89501824322542 }
  ],
  shapes: [],
  margin: 2048,
  trees: [
    { x: -1527.000099316237, y: -543.999930858613, angle: 170.8107839139136, i: 6 },
    { x: -1852.0000944733602, y: -363.999933540822, angle: 72.04115133351749, i: 5 },
    { x: -2167.0000897794944, y: -168.99993644654842, angle: 168.3191262842924, i: 10 },
    { x: -2297.0000878423434, y: -28.999938532710985, angle: 158.6805734617804, i: 2 },
    { x: -1987.0000924617034, y: -318.99993421137424, angle: 18.610536951608193, i: 11 },
    { x: -1752.0000959634758, y: -478.99993182718845, angle: 160.0241983260589, i: 8 },
    { x: -1377.0001015514113, y: -588.9999301880607, angle: 23.468521502484542, i: 1 },
    { x: -1172.0001046061493, y: -648.9999292939913, angle: 41.55799772645584, i: 6 },
    { x: -937.0001081079222, y: -668.999928995968, angle: 47.93637702255407, i: 11 },
    { x: -737.000111088154, y: -698.9999285489332, angle: 152.25596645298805, i: 11 },
    { x: -1047.0001064687945, y: -698.9999285489332, angle: 42.584685921857634, i: 10 },
    { x: -3177.0000747293216, y: 951.0000468641515, angle: 149.409949729148, i: 12 },
    { x: -3287.000073090194, y: 1031.0000456720586, angle: 51.1721592042385, i: 7 },
    { x: -3352.0000721216184, y: 1196.000043213367, angle: 152.86896415787353, i: 13 },
    { x: -3367.000071898101, y: 1261.0000422447915, angle: 39.60603611172073, i: 2 },
    { x: -3387.0000716000777, y: 1536.0000381469727, angle: 104.46568005746039, i: 8 },
    { x: -3352.0000721216184, y: 1736.0000351667404, angle: 46.21530466175643, i: 8 },
    { x: -3287.000073090194, y: 1861.0000333040953, angle: 148.61856461123634, i: 11 },
    { x: -3457.000070556997, y: 1356.0000408291812, angle: 58.485166929080734, i: 5 },
    { x: -3217.000074133275, y: 2001.0000312179327, angle: 38.48255926339782, i: 12 },
    { x: -87.00012077390875, y: 2671.0000212341547, angle: 149.29939272430315, i: 12 },
    { x: 102.99987639487063, y: 2626.000021904707, angle: 8.662938582413421, i: 2 },
    { x: 362.9998725205687, y: 2656.000021457672, angle: 32.30062012419013, i: 1 },
    { x: 637.9998684227494, y: 2716.0000205636024, angle: 169.65512437833297, i: 5 },
    { x: 782.999866262081, y: 2721.0000204890966, angle: 67.12867452446989, i: 4 },
    { x: 957.9998636543778, y: 2826.0000189244747, angle: 54.841462033205495, i: 4 },
    { x: 1192.999860152605, y: 2856.00001847744, angle: 125.29919527652247, i: 1 },
    { x: 1412.9998568743504, y: 2911.000017657876, angle: 38.63244721475588, i: 1 },
    { x: 4177.999815672641, y: -873.99992594123, angle: 56.80361605535991, i: 13 },
    { x: 4417.999812096362, y: -838.9999264627706, angle: 178.5492333402786, i: 10 },
    { x: 4557.999810010199, y: -778.9999273568403, angle: 13.783664658934459, i: 9 },
    { x: 4652.999808594589, y: -653.9999292194855, angle: 164.5041138256079, i: 4 },
    { x: 4822.999806061392, y: -558.9999306350956, angle: 60.2082730308717, i: 8 },
    { x: 4952.999804124241, y: -378.99993331730457, angle: 12.124631606102309, i: 5 },
    { x: 3972.9998187273786, y: -873.99992594123, angle: 3.3818859854865835, i: 9 },
    { x: 3772.999821707611, y: -848.999926313759, angle: 18.09666466239509, i: 5 },
    { x: 4127.999816417699, y: 2111.000029578805, angle: 135.36082234778107, i: 3 },
    { x: 4022.9998179823206, y: 2176.0000286102295, angle: 78.95716322915763, i: 13 },
    { x: 3872.9998202174947, y: 2326.0000263750553, angle: 122.91766085056405, i: 9 },
    { x: 3792.9998214095876, y: 2476.000024139881, angle: 1.8556596510487067, i: 4 },
    { x: 3517.999825507407, y: 2591.0000224262476, angle: 179.90963555948244, i: 5 },
    { x: 3657.9998234212444, y: 2601.000022277236, angle: 79.4780987562595, i: 6 },
    { x: 3922.9998194724367, y: 2636.0000217556953, angle: 139.33903666476883, i: 13 },
    { x: 4142.999816194181, y: 2566.0000227987766, angle: 141.22716618288257, i: 4 },
    { x: 4337.999813288455, y: 2451.00002451241, angle: 147.58328024109042, i: 9 },
    { x: 4472.999811276798, y: 2311.0000265985727, angle: 149.40517222389158, i: 1 },
    { x: 4472.999811276798, y: 2041.0000306218863, angle: 101.11192601155685, i: 9 },
    { x: 4332.999813362961, y: 2201.0000282377005, angle: 133.72718679482256, i: 9 },
    { x: 4147.999816119675, y: 2321.000026449561, angle: 126.70844729930283, i: 10 },
    { x: 4257.999814480548, y: 1986.0000314414501, angle: 142.82528670677743, i: 6 },
    { x: 3972.9998187273786, y: 2436.0000247359276, angle: 17.823466483050762, i: 5 },
    { x: 4542.999810233717, y: 1806.0000341236591, angle: 34.82242021598911, i: 9 },
    { x: 4332.999813362961, y: 1821.0000339001417, angle: 91.76562444682722, i: 4 },
    { x: 2157.9998457729853, y: -888.9999257177126, angle: 153.60824524257401, i: 1 },
    { x: 1832.9998506158627, y: -858.9999261647474, angle: 31.97407601569997, i: 8 },
    { x: 1507.99985545874, y: -888.9999257177126, angle: 5.3099308626477715, i: 13 },
    { x: 1262.9998591095236, y: -888.9999257177126, angle: 80.17147462993559, i: 3 },
    { x: 1047.9998623132733, y: -858.9999261647474, angle: 27.222951463938834, i: 12 },
    { x: 1677.9998529255427, y: -973.9999244511139, angle: 173.84544714590515, i: 7 },
    { x: 2337.9998430907763, y: -858.9999261647474, angle: 64.0822608990161, i: 8 },
    { x: 2507.999840557579, y: -763.9999275803577, angle: 173.00004003479327, i: 3 },
    { x: 542.9998698383597, y: 2751.000020042062, angle: 78.61822168853402, i: 2 }
  ],
  id: 1620766018827
};

trackList[1] = track_1;
